<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moodii å¿ƒèªæ—¥è¨˜</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#E9A68B" />
</head>

<body>
  <div class="container">
    <img src="images/cover-clean.png" alt="Moodii é¦–é åœ–" class="hero-img" />
    <h1 class="main-title">å¿ƒèªæ—¥è¨˜</h1>
    <p class="hint-text">ä»Šå¤©ï¼Œå±¬æ–¼ä½ çš„å¿ƒæƒ…æ˜¯ä»€éº¼å‘¢ï¼Ÿ</p>
    <button class="main-btn" onclick="fadeToNext()">é–‹å§‹è¨˜éŒ„</button>

    <div class="calendar-section">
      <div class="calendar-header">
        <button class="nav-arrow" onclick="changeMonth(-1)">â†</button>
        <h2 class="calendar-title" id="calendar-title">ğŸ—“ å¿ƒæƒ…æœˆæ›†</h2>
        <button class="nav-arrow" onclick="changeMonth(1)">â†’</button>
      </div>
      <div id="calendar-grid" class="calendar-grid"></div>
    </div>
    
    
    <button class="secondary-btn" onclick="window.location.href='history.html'">æŸ¥çœ‹æ­·å²ç´€éŒ„</button>
    <!-- å»ºè­°æ”¾åœ¨é¦–é åº•éƒ¨æŒ‰éˆ•ç¾¤ä¸‹é¢ -->
    <button id="install-btn" class="secondary-btn" style="display: none;">â• å®‰è£ App</button>


  </div>

  <script>
    function fadeToNext() {
      document.querySelector('.container').style.opacity = 0;
      setTimeout(() => {
        window.location.href = "input.html"; // æˆ–æ›æˆ alert() æ¨¡æ“¬
      }, 500);
    }

    const moodColors = {
        happy: "#FFF5B5",
        neutral: "#DDDDDD",
        sad: "#AEDBFF",
        tired: "#D8C9EC",
        angry: "#FFC1B6"
      };

      let currentYear = new Date().getFullYear();
      let currentMonth = new Date().getMonth();

      function generateCalendar(year, month) {
        const title = document.getElementById("calendar-title");
        title.textContent = `ğŸ—“ ${year}å¹´${month + 1}æœˆ`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const grid = document.getElementById("calendar-grid");
        grid.innerHTML = "";

        const data = JSON.parse(localStorage.getItem("moodHistory")) || [];

        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement("div");
          grid.appendChild(empty);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const cell = document.createElement("div");
          cell.className = "calendar-cell";
          const dateStr = `${year}-${(month + 1).toString().padStart(2, "0")}-${d.toString().padStart(2, "0")}`;
          const record = data.find(item => item.date === dateStr);

          if (record) {
            cell.style.backgroundColor = moodColors[record.mood] || "#EEE";
            cell.setAttribute("data-text", record.text || "ï¼ˆæ²’æœ‰å…§å®¹ï¼‰");
            if (record.starred) {
              cell.innerHTML = `${d}<span class="calendar-star">â­</span>`;
            } else {
              cell.textContent = d;
            }
          } else {
            cell.style.opacity = 0.3;
            cell.textContent = d;
          }

          grid.appendChild(cell);
        }
      }

      function changeMonth(offset) {
        currentMonth += offset;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear -= 1;
        } else if (currentMonth > 11) {
          currentMonth = 0;
          currentYear += 1;
        }
        generateCalendar(currentYear, currentMonth);
      }

      generateCalendar(currentYear, currentMonth);

      /*document.addEventListener("DOMContentLoaded", () => {
          if ("Notification" in window) {
            if (Notification.permission === "default") {
              Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                  scheduleReminder();
                }
              });
            } else if (Notification.permission === "granted") {
              scheduleReminder();
            }
          }

          function scheduleReminder() {
            // æ¯ 24 å°æ™‚æé†’ä¸€æ¬¡ï¼ˆç°¡æ˜“æ¨¡æ“¬ï¼‰
            setTimeout(() => {
              new Notification("ğŸŒŸ Moodii å¿ƒèªæé†’", {
                body: "ä»Šå¤©é‚„æ²’å¯«ä¸‹ä½ çš„å¿ƒæƒ…å–”ï½ Moodii åœ¨é€™è£¡ç­‰ä½  ğŸ’›",
                icon: "images/moodii-default.png"
              });
            }, 3000); // âš ï¸ DEMO æ¸¬è©¦ç”¨ï¼š3 ç§’å¾Œè·³å‡ºï¼Œæ­£å¼å¯è¨­ç‚º 6 å°æ™‚ã€12 å°æ™‚å¾Œ
          }
        });*/

        // âœ… å®‰è£ service worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('Service Worker å·²è¨»å†ŠæˆåŠŸ'))
      .catch(err => console.error('è¨»å†Šå¤±æ•—:', err));
  }

  // âœ… é€šçŸ¥æé†’åŠŸèƒ½
  document.addEventListener("DOMContentLoaded", () => {
  // è¨»å†Š Service Workerï¼ˆåªè¦åšä¸€æ¬¡ï¼‰
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('Service Worker å·²è¨»å†ŠæˆåŠŸ'))
      .catch(err => console.error('è¨»å†Šå¤±æ•—:', err));
  }

  // å•Ÿç”¨é€šçŸ¥åŠŸèƒ½
  if ("Notification" in window) {
    if (Notification.permission === "default") {
      Notification.requestPermission().then(permission => {
        if (permission === "granted") {
          scheduleReminder();
        }
      });
    } else if (Notification.permission === "granted") {
      scheduleReminder();
    }
  }

  function scheduleReminder() {
    // DEMO ç”¨ï¼š3 ç§’å¾Œå‡ºç¾é€šçŸ¥ï¼Œæ­£å¼ç’°å¢ƒå¯æ”¹ç‚ºæ¯å¤©å®šæ™‚
    setTimeout(() => {
      new Notification("ğŸŒŸ Moodii å¿ƒèªæé†’", {
        body: "ä»Šå¤©é‚„æ²’å¯«ä¸‹ä½ çš„å¿ƒæƒ…å–”ï½ Moodii åœ¨é€™è£¡ç­‰ä½  ğŸ’›",
        icon: "images/moodii-default.png"
      });
    }, 3000);
  }
});


  let deferredPrompt;

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault(); // é˜»æ­¢ç€è¦½å™¨è‡ªå‹•é¡¯ç¤º
    deferredPrompt = e;

    const installBtn = document.getElementById("install-btn");
    installBtn.style.display = "inline-block"; // é¡¯ç¤ºå®‰è£æŒ‰éˆ•

    installBtn.addEventListener("click", () => {
      installBtn.style.display = "none"; // é»äº†å°±éš±è—
      deferredPrompt.prompt(); // å½ˆå‡ºå®‰è£æç¤º
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === "accepted") {
          console.log("ä½¿ç”¨è€…æ¥å—å®‰è£");
        } else {
          console.log("ä½¿ç”¨è€…æ‹’çµ•å®‰è£");
        }
        deferredPrompt = null;
      });
    });
  });

  </script>
</body>

</html>