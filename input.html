<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿ƒèªæ—¥è¨˜ - è¼¸å…¥æƒ…ç·’</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet" />
</head>

<body>
  <audio id="bgm" loop>
    <source src="music/bgm.mp3" type="audio/mpeg" />
  </audio>
  
  <div class="container">
    <h1 class="main-title">å¯«ä¸‹ä»Šå¤©çš„å¿ƒèª</h1>
    <input type="text" placeholder="æœ‰é»ç´¯äº†å‘¢..." class="text-input">

    <p class="hint-text">é¸æ“‡ä½ çš„å¿ƒæƒ…ï¼š</p>
    <div class="emoji-group">
      <span class="emoji" data-value="happy">ğŸ˜Š</span>
      <span class="emoji" data-value="neutral">ğŸ˜</span>
      <span class="emoji" data-value="sad">ğŸ˜¢</span>
      <span class="emoji" data-value="tired">ğŸ˜–</span>
      <span class="emoji" data-value="angry">ğŸ˜¡</span>
    </div>
    

    <button class="main-btn" id="submit-btn">å®Œæˆè¨˜éŒ„</button>
    <button class="secondary-btn" onclick="window.location.href='index.html'">å›é¦–é </button>

    <div id="response" class="mood-response"></div>
  </div>


  <script>
    const emojis = document.querySelectorAll('.emoji');
      let selectedMood = "";

      // é¸æ“‡è¡¨æƒ…é‚è¼¯
      emojis.forEach(emoji => {
        emoji.addEventListener('click', () => {
          emojis.forEach(e => e.classList.remove('selected'));
          emoji.classList.add('selected');
          selectedMood = emoji.getAttribute('data-value');
        });
      });

      // å®Œæˆè¨˜éŒ„æŒ‰éˆ•é‚è¼¯ï¼ˆåªæœ‰ä¸€å€‹äº‹ä»¶ç›£è½å™¨ï¼ï¼‰
      document.getElementById('submit-btn').addEventListener('click', () => {
        const text = document.querySelector('.text-input').value;
        const today = new Date().toISOString().slice(0, 10);

        if (!selectedMood) {
          alert("è«‹å…ˆé¸æ“‡ä½ çš„å¿ƒæƒ…å–”ï¼");
          return;
        }

        const record = {
          date: today,
          mood: selectedMood,
          text: text
        };

        const existing = JSON.parse(localStorage.getItem("moodHistory")) || [];
        const updated = existing.filter(item => item.date !== today);
        updated.push(record);

        localStorage.setItem("moodHistory", JSON.stringify(updated));
        localStorage.setItem("selectedMood", selectedMood); // ç•™çµ¦ result.html ç”¨

        alert("å·²è¨˜éŒ„ï¼ä½ å¾ˆæ£’ ğŸ’›");
        window.location.href = "result.html";
      });

      // âœ… åµæ¸¬ä»Šå¤©æ˜¯å¦å·²è¨˜éŒ„
        window.addEventListener("DOMContentLoaded", () => {
          const today = new Date().toISOString().slice(0, 10);
          const existing = JSON.parse(localStorage.getItem("moodHistory")) || [];

          const todayRecord = existing.find(item => item.date === today);

          if (todayRecord) {
            // å·²è¨˜éŒ„é âœ é¡¯ç¤ºæç¤ºã€åœç”¨æŒ‰éˆ•
            const notice = document.createElement("p");
            notice.textContent = "ä½ ä»Šå¤©å·²ç¶“è¨˜éŒ„éå›‰ ğŸ˜Š æ˜å¤©å†ä¾†æ‰¾æˆ‘å§ï½";
            notice.style.color = "#888";
            notice.style.marginTop = "12px";
            notice.style.fontSize = "16px";
            notice.style.fontStyle = "italic";

            document.querySelector(".container").appendChild(notice);

            const btn = document.getElementById("submit-btn");
            btn.disabled = true;
            btn.style.backgroundColor = "#ccc";
            btn.style.cursor = "not-allowed";
          }
        });

  </script>
  <script src="js/bgm.js"></script>
</body>

</html>